---
title: "Exercise #3"
subtitle: "Fortgeschrittene Statistische Software für NF"
author: "Adrian Weghorst (12574619), Luca Wißmeyer (12555872)"
date: "`r Sys.Date()`"
output: 
  distill::distill_article:
    nop: nop
  bookdown::pdf_document2:
    number_sections: false
editor_options: 
  markdown: 
    wrap: 72
---

## General Remarks

-   You can submit your solutions in teams of up to 3 students.
-   Include all your team-member's names and student numbers
    (Martrikelnummern) in the `authors` field.
-   Please use the exercise template document to work on and submit your
    results.
-   Use a level 2 heading for each new exercise and answer each subtask
    next to it's bullet point or use a new level 3 heading if you want.
-   Always render the R code for your solutions and make sure to include
    the resulting data in your rendered document.
    -   Make sure to not print more than 10 rows of data (unless
        specifically instructed to).
-   Always submit both the rendered document(s) as well as your source
    Rmarkdown document. Submit the files separately on moodle, **not**
    as a zip archive.

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(gganimate)
library(transformr)
library(gifski)
```

## Exercise 1: Initializing git (4 Points)

For this whole exercise sheet we will be tracking all our changes to it
in git.

### a) Start by initializing a new R project with git support, called `2024-exeRcise-sheet-3`. If you forgot how to do this, you can follow this [guide](https://malikaihle.github.io/Introduction-RStudio-Git-GitHub/rstudio_project.html).

### b) Commit the files generated by Rstudio.

### c) For all of the following tasks in this exercise sheet we ask you to always commit your changes after finishing each subtask e.g. create a commit after task *1d*, *1e* etc.

> Note: This applies only to answers that have text or code as their
> answer. If you complete tasks in a different order or forget to commit
> one, this is no problem. If you change your answers you can just
> create multiple commits to track the changes.

### d) Name 2 strengths and 2 weaknesses of git. (Don't forget to create a commit after this answer, see *1c*)

Strengths of Git:

Each user has a complete local copy of the entire repository history,
allowing for offline work and enhancing collaboration without relying on
a central server.

Git's lightweight branching and efficient merging capabilities make it
easy to experiment, manage, and integrate changes without disrupting the
main codebase.

Weaknesses of Git:

The vast array of commands and options, along with the conceptual
complexity, can be overwhelming for new users, leading to a steep
learning curve.

Git is not optimized for large binary files, which can bloat the
repository and degrade performance, making it less suitable for projects
with significant binary content.

### e) Knit this exercise sheet. Some new files will automatically be generated when knitting the sheet e.g. the HTML page. Ignore these files, as we only want to track the source files themselves.

## Exercise 2: Putting your Repository on GitHub (3.5 Points)

For this task you will upload your solution to GitHub.

### a) Create a new repository on GitHub in your account named `exeRcise-sheet-3`. Make sure you create a **public repository** so we are able to see it for grading. Add the link to the repository below: 

<https://github.com/Wizzardexe/exeRcise-sheet-3>

### b) Push your code to this new repository by copying and executing the snippet on github listed under `…or push an existing repository from the command line`.

### c) Regularly push your latest changes to GitHub again and especially do so when you are finished with this sheet.


## Exercise 3: Baby-Names in Munich (3.5 Points)

Download the latest open datasets on given names ("Vornamen") from the
open data repository of the city of Munich for the years `2023` and
`2022`.

Link: <https://opendata.muenchen.de/dataset/vornamen-von-neugeborenen>

### a) Download the data for both years and track it in git. For small datasets like these adding them to git is not a problem.

### b)
         
Load the data for both years into R. Check the type of the count
variable ("Anzahl") and look into the data to determine why it is
not numeric? Fix the problem in an appropriate manner, it is OK if
some of the counts are inaccurate because of this. Explain your
solution and the repercussions.


```{r}
names_2022_data <- read.csv(file.path("data", "open_data_portal_2022.csv"))
names_2023_data <- read.csv(file.path("data", "vornamen-muenchen-2023.csv"))
```

        
The datatype for "Anzahl" is r typeof(names_2022_data[,2]). The character 
type was used because names with fewer than 5 appearances were categorized 
as "4 oder weniger".


```{r message=FALSE, warning=FALSE}
names_2022_data <- names_2022_data %>%
                            mutate(Anzahl = ifelse(Anzahl == "4 oder weniger",2.5 ,as.numeric(Anzahl)))
names_2023_data <- names_2023_data %>%
                            mutate(Anzahl = ifelse(Anzahl == "4 oder weniger",2.5 ,as.numeric(Anzahl)))
```

       
The phrase "4 oder weniger" was changed to the mean of the four possible 
values. Additionally, the presence of a non-integer value 
indicates that the number was not obtained by counting.


### c) Calculate the total number of babies born in Munich in 2022 and 2023. Which year had the bigger baby-boom?


```{r}
total_babies_2022 <- round(sum(names_2022_data[,2]))
total_babies_2023 <- round(sum(names_2023_data[,2]))
diff_total_babies <- abs(total_babies_2022 - total_babies_2023)
```

In the year 2022, `r total_babies_2022` babies were born. One year later, 
the number decreased by `r diff_total_babies` babies, totaling 
`r total_babies_2023` in 2023.


### d) Add a new column `year` to both datasets which holds the correct year for each.


```{r}
names_2022_data <- names_2022_data %>%
                            mutate(year = 2022)
names_2023_data <- names_2023_data %>%
                            mutate(year = 2023)
```

### e) Combine both datasets into one using `bind_rows()`.

```{r}
names_2022_2023_data <- bind_rows(names_2022_data, names_2023_data)
```

### f) Combine the counts for same names to determine the most popular names across both years. Print out the top 10 names in a nicely formatted table for both years. Include a table caption.

```{r}
names_2022_2023_data %>%
            group_by(Vorname) %>%
            summarise(
              count = sum(Anzahl, na.rm = TRUE)
            ) %>%
            arrange(desc(count)) %>%
            head(10) %>%
            knitr::kable(col.names = c("Surname", "Count"), caption = "Top 10 Baby Names in Munich for 2022/23")
```

## Exercise 4: Open Analysis (4 points)

This exercise is a bit more open-ended. You can choose any dataset from
[Our World in Data](https://ourworldindata.org/) and analyze it, while
determining the research question yourself.

### a)
        
Go to <https://github.com/owid/owid-datasets/tree/master/datasets>
and choose a dataset that interests you. You can have a look at
<https://ourworldindata.org/> to gather some inspiration.

### b) Download the dataset and track it in git.

```{r}
suicide_data <- read_csv(file.path("data", "Suicide rates by sex and age (IHME, 2019).csv"), show_col_types = FALSE)
suicide_data <- suicide_data %>%
                        rename(
                          male_suicide_rate_age_standardized = `Male suicide rate (age-standardized)`,
                          female_suicide_rate_age_standardized = `Female suicide rate (age-standardized)`,
                          country = Entity     
                          )
names(suicide_data) <- tolower(names(suicide_data))
```

### c) Put the name / title of the dataset and a link to it below.

-   Dataset Name: Suicide rates by sex and age (IHME, 2019)
-   Link: [Link to Github](https://github.com/owid/owid-datasets/tree/master/datasets/Suicide%20rates%20by%20sex%20and%20age%20(IHME%2C%202019))

### d)  Come up with a (research) question you want to answer with the data and briefly explain why you believe this is an interesting question within one sentence. It should be a question that can be answered with the dataset and using R.

Research Question: What is the trend of the male suicide rates over time in different countries and regions?

Explanation: This question is interesting because analyzing temporal trends can reveal changes in the prevalence of suicide among various demographics, helping to assess the effectiveness of past interventions and inform future strategies.

### e)  Use R to answer your chosen question.

```{r}
compute_trend_m <- function(data) {
  model <- lm(male_suicide_rate_age_standardized ~ year, data = data)
  trend <- coef(model)[2]  # Slope of the trend
  return(trend)
}

trends_male <- suicide_data %>%
                      group_by(country) %>%
                      summarise(trend = as.numeric(compute_trend_m(cur_data())))

negativ_trend <- trends_male %>%
                      filter(trend <= 0) %>%
                      arrange(trend) 
            
positiv_trend <- trends_male %>%
                      filter(trend > 0) %>%
                      arrange(desc(trend)) 

positiv_trend %>%
      head(15) %>%
      knitr::kable(col.names = c("Country", "Increase"), caption = "Trend of the top 15 Counties/Regions with increasing Suicides per Year")
```

Based on the data, the possible reasons for the increasing suicide rates in the top 15 countries/regions appear to be:

1. High Levels of Stress or Pressure: Countries with high societal, academic, or work-related pressure tend to have higher suicide rates.
2. Economic Hardship: Countries facing severe economic difficulties often see higher suicide rates due to financial stress and related issues.
3. Social and Cultural Factors: Social issues, such as domestic violence, substance abuse, and cultural stigma around mental health, significantly impact suicide rates.
4. Lack of Mental Health Resources: Countries with inadequate mental health infrastructure and support systems often have higher suicide rates due to the lack of available help.



```{r}
negativ_trend %>%
      head(15) %>%
      knitr::kable(col.names = c("Country", "Decrease"), caption = "Trend of the top 15 Counties/Regions with decreasing Suicides per Year")
```

Based on the data, the possible reasons for the decreasing suicide rates in the top 15 countries/regions appear to be:

1. Improved Mental Health Resources: Countries with better access to mental health care and resources often see a reduction in suicide rates.
2. Economic Stability: Economic stability can lead to a decrease in suicide rates as financial stress diminishes.
3. Social and Cultural Changes: Changes in social norms and cultural attitudes towards mental health and suicide can contribute to a decline in rates.
4. Successful Prevention Programs Countries with effective suicide prevention programs and policies in place see significant decreases in suicide rates.


### f)  Create a meaningful plot / figure with the dataset. Make sure to provide a figure caption (via the chunk options / Rmarkdown) and correctly label the figure.

```{r}
# Data sourced from https://www.imf.org/en/Publications/WEO/weo-database/2024/April/download-entire-database
country_data <- data.frame(
  country = c('United States', 'China', 'Japan', 'Germany', 'India', 'United Kingdom', 'France', 'Italy', 'Brazil', 'Canada'),
  Nominal_GDP_in_trillions_USD = c(25.35, 17.73, 4.94, 4.22, 3.18, 3.13, 3.06, 2.1, 1.83, 1.74)
)
```


```{r fig.cap="Suicide Rates per 100,000 in Top 10 Nominal GDP Countries (1990-2017)"}
gdp_suicide_data <- inner_join(suicide_data, country_data, by = "country")

anim <- ggplot(
  data = gdp_suicide_data,
  mapping = aes(
    x = female_suicide_rate_age_standardized,
    y = male_suicide_rate_age_standardized,
    color = country
  )
) + 
  geom_point() +
  labs(
    title = "Year: {round(frame_time)}",
    x = "Female Suicide Rate",
    y = "Male Suicide Rate",
    color = "Country"
  ) +
  theme_bw() +
  transition_time(year)

animate(
  anim,
  duration = 25, fps = 20,
  height = 4, width = 5,
  units = "in", res = 400,
  renderer = gifski_renderer("gapminder_slowed.gif")
)
```

## Final Note

Make sure to push all your commits and changes to GitHub before
submittining the exercise sheet.
